<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PWA Demo</title>
  <link rel="stylesheet" href="style.css">
  <link rel="manifest" href="manifest.json">
  <link rel="manifest" href="manifest.json?v=2">

</head>
<body>

  <div class="topbar">
    <nav class="nav" id="mainNav">
      <button data-key="home" class="nav-btn active">HOME </button>
      <button data-key="notices" class="nav-btn">Notices</button>
      <button data-key="biblestudy" class="nav-btn">Bible<br/>Study</button>
      <button data-key="connect" class="nav-btn">Connect</button>
      <button data-key="settings" class="nav-btn">Settings</button>
    </nav>
  </div>

  <div class="container">

    <!-- Main dynamic content area -->
   <div id="contentArea" style="flex:1;"></div>

     <!-- Right settings panel -->
    <aside class="settings" id="settingsPanel">
      <h3>SETTINGS</h3>
      <div class="row">
        <div class="label">Change Font</div>
        <select id="fontSelect" class="font-select">
          <option value="Calibri, Arial, sans-serif">Calibri ( Body )</option>
          <option value="Arial, Helvetica, sans-serif">Arial</option>
          <option value="Georgia, 'Times New Roman', serif">Georgia</option>
          <option value="'Segoe UI', Tahoma, Geneva, sans-serif">Segoe UI</option>
        </select>
      </div>
      <div class="row">
        <div class="label">Change Theme</div>
        <div style="display:flex;gap:8px">
          <button class="small-btn" id="lightBtn">Light mode</button>
          <button class="small-btn" id="darkBtn">Dark mode</button>
        </div>
      </div>
      <div class="row">
        <div class="label">Change Language</div>
        <div style="display:flex;gap:8px">
          <button class="small-btn active" id="langEn">English</button>
          <button class="small-btn" id="langSw">Swahili</button>
        </div>
      </div>
      <div class="section-title">Others</div>
      <div class="row">
        <div class="label">About App</div>
        <div class="muted">v1 — Prototype</div>
      </div>
      <div class="row">
        <div class="label">Show storage usage</div>
        <button class="small-btn" id="showStorageBtn">Show</button>
      </div>
    </aside>

  </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  /* ----------------- State & DOM refs ----------------- */
  const state = {
    font: localStorage.getItem('ui.font') || 'Calibri, Arial, sans-serif',
    theme: localStorage.getItem('ui.theme') || 'light',
    lang: localStorage.getItem('ui.lang') || 'en',
    activeNav: localStorage.getItem('ui.activeNav') || 'home'
  };

  const mainNav = document.getElementById('mainNav');
  const contentArea = document.getElementById('contentArea');
  const fontSelect = document.getElementById('fontSelect');
  const lightBtn = document.getElementById('lightBtn');
  const darkBtn = document.getElementById('darkBtn');
  const langEn = document.getElementById('langEn');
  const langSw = document.getElementById('langSw');
  const settingsPanel = document.getElementById('settingsPanel');
  const showStorageBtn = document.getElementById('showStorageBtn');

  const T = {
    en: { home: 'Home data coming soon  ...', save: 'SAVE' },
    sw: { home: 'Taarifa za nyumbani zitakuja hivi karibuni  ...', save: 'HIFADHI' }
  };

  /* ----------------- Helpers ----------------- */
  function applySettings() {
    document.body.style.fontFamily = state.font;
    document.documentElement.setAttribute('data-theme', state.theme === 'dark' ? 'dark' : 'light');
    if (fontSelect) fontSelect.value = state.font;
    if (lightBtn) lightBtn.classList.toggle('active', state.theme === 'light');
    if (darkBtn) darkBtn.classList.toggle('active', state.theme === 'dark');
    if (langEn) langEn.classList.toggle('active', state.lang === 'en');
    if (langSw) langSw.classList.toggle('active', state.lang === 'sw');
  }

  // Pause every <video> except the optional allow element
  function pauseAllVideos(allowEl = null) {
    document.querySelectorAll('video').forEach(v => {
      if (allowEl && (v === allowEl || v.contains(allowEl))) return;
      try { v.pause(); } catch (e) { /* ignore */ }
    });
  }

  // Attach behaviors to video elements inside a rendered target
  function attachMediaControls(target) {
    if (!target) return;
    const videos = target.querySelectorAll('video');
    videos.forEach(v => {
      // ensure only one video plays at a time
      v.removeEventListener('play', v._playHandler || (() => {}));
      v._playHandler = () => pauseAllVideos(v);
      v.addEventListener('play', v._playHandler);

      // double-click toggles fullscreen (nice UX)
      v.addEventListener('dblclick', async () => {
        try {
          if (document.fullscreenElement) await document.exitFullscreen();
          else await v.requestFullscreen();
        } catch (e) { /* ignore */ }
      });
    });
  }

  /* ----------------- Templating ----------------- */
  function homeHTML() {
    // Use multiple <source> entries so different hosting layouts work
    return `
      <div class="home-section">
       <img src="./church-service.jpg" alt="Welcome Image" class="home-img" />


        <video class="home-video" controls playsinline preload="metadata" style="width:100%;">
          <source src="./first-video.mp4" type="video/mp4" />
          <source src="./videos/first-video.mp4" type="video/mp4" />
          <source src="/first-video.mp4" type="video/mp4" />
          Your browser does not support the video tag.
        </video>

        <p>${T[state.lang].home}</p>
      </div>
    `;
  }

  function noticesHTML() {
    return `<p class="muted">Wednesday miracle service from 5:30pm to 6:30pm</p>`;
  }
  function bibleStudyHTML() {
    return `<strong>Bible Study</strong><p class="muted">Today's topic: —</p>`;
  }
  function connectHTML() {
    return `<p class="muted">Connect with the community</p>`;
  }

  /* ----------------- Reusable renderer ----------------- */
  function renderSection(target, section) {
    if (!target) return;
    // ensure no rogue video is left playing
    pauseAllVideos();

    // standard sections
    if (section === 'home') {
      target.innerHTML = homeHTML();
      attachMediaControls(target);
      if (target === contentArea) settingsPanel && settingsPanel.classList.remove('active');
      return;
    }
    if (section === 'notices') {
      target.innerHTML = noticesHTML();
      if (target === contentArea) settingsPanel && settingsPanel.classList.remove('active');
      return;
    }
    if (section === 'biblestudy') {
      target.innerHTML = bibleStudyHTML();
      if (target === contentArea) settingsPanel && settingsPanel.classList.remove('active');
      return;
    }
    if (section === 'connect') {
      target.innerHTML = connectHTML();
      if (target === contentArea) settingsPanel && settingsPanel.classList.remove('active');
      return;
    }

    // settings -> create preview + mini nav (reuses renderSection for mini)
    if (section === 'settings') {
      target.innerHTML = `
        <div id="previewWrapper">
          <div class="preview-frame" id="previewFrame" style="display:flex;flex-direction:column;">
            <div class="preview-inner" id="miniApp">
              <div class="topbar">
                <nav class="nav" id="miniNav">
                  <button class="nav-btn active" data-mini="home">HOME</button>
                  <button class="nav-btn" data-mini="notices">Notices</button>
                  <button class="nav-btn" data-mini="biblestudy">Bible<br/>Study</button>
                  <button class="nav-btn" data-mini="connect">Connect</button>
                  <button class="nav-btn" data-mini="settings">Settings</button>
                </nav>
              </div>
              <div class="content" id="miniContent"></div>
            </div>
            <div class="save-row">
              <button id="saveBtn" class="btn">${T[state.lang].save}</button>
            </div>
          </div>
          <div class="save-row">
            <button id="togglePreviewBtn" class="btn">Hide Preview</button>
          </div>
        </div>
      `;
      // show settings panel visually (your CSS controls .active)
      settingsPanel && settingsPanel.classList.add('active');

      // hook mini nav
      const miniNav = document.getElementById('miniNav');
      const miniContent = document.getElementById('miniContent');

      // default mini view
      renderSection(miniContent, 'home');

      // attach mini nav handlers
      miniNav.querySelectorAll('.nav-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          miniNav.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          renderSection(miniContent, btn.dataset.mini);
        });
        // keyboard support
        btn.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); btn.click(); } });
      });

      // toggle preview frame
      const previewFrame = document.getElementById('previewFrame');
      const toggleBtn = document.getElementById('togglePreviewBtn');
      toggleBtn.addEventListener('click', () => {
        if (previewFrame.style.display === 'none') {
          previewFrame.style.display = 'flex';
          toggleBtn.textContent = 'Hide Preview';
        } else {
          // pause any videos inside the mini preview before hiding
          const miniVideo = miniContent.querySelector('video');
          if (miniVideo) miniVideo.pause();
          previewFrame.style.display = 'none';
          toggleBtn.textContent = 'Show Preview';
        }
      });

      // save handler
      const saveBtn = document.getElementById('saveBtn');
      saveBtn.addEventListener('click', () => {
        localStorage.setItem('ui.font', state.font);
        localStorage.setItem('ui.theme', state.theme);
        localStorage.setItem('ui.lang', state.lang);
        localStorage.setItem('ui.activeNav', state.activeNav);
        saveBtn.textContent = 'Saved';
        setTimeout(() => saveBtn.textContent = T[state.lang].save, 900);
      });

      return;
    }

    // fallback empty
    target.innerHTML = '';
  }

  /* ----------------- Wiring main nav (single source of truth) ----------------- */
  function attachMainNav() {
    if (!mainNav) return;
    mainNav.querySelectorAll('.nav-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        mainNav.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const key = btn.dataset.key;
        state.activeNav = key;
        localStorage.setItem('ui.activeNav', state.activeNav);
        renderSection(contentArea, key);
      });
      // keyboard support (Enter / Space)
      btn.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); btn.click(); } });
    });
  }

  /* ----------------- Settings controls ----------------- */
  if (fontSelect) fontSelect.addEventListener('change', e => { state.font = e.target.value; applySettings(); });
  if (lightBtn) lightBtn.addEventListener('click', () => { state.theme = 'light'; applySettings(); });
  if (darkBtn) darkBtn.addEventListener('click', () => { state.theme = 'dark'; applySettings(); });
  if (langEn) langEn.addEventListener('click', () => { state.lang = 'en'; applySettings(); });
  if (langSw) langSw.addEventListener('click', () => { state.lang = 'sw'; applySettings(); });

  if (showStorageBtn) showStorageBtn.addEventListener('click', () => {
    let total = 0;
    for (let k in localStorage) {
      if (localStorage.hasOwnProperty(k)) total += (localStorage[k].length + k.length) * 2;
    }
    alert('Estimated localStorage usage: ' + Math.round(total / 1024) + ' KB');
  });

  /* ----------------- Init ----------------- */
  applySettings();
  attachMainNav();
  // render initial main view
  renderSection(contentArea, state.activeNav || 'home');
});
</script>

   <script src="app.js"></script>
   </body>
</html>
